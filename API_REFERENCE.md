# EchoGuard API Reference

**Version**: 1.0.0
**Last Updated**: 2024

## Table of Contents

1. [Authentication](#authentication)
2. [Agent APIs](#agent-apis)
3. [Supervisor APIs](#supervisor-apis)
4. [Admin APIs](#admin-apis)
5. [Error Handling](#error-handling)
6. [Demo Credentials](#demo-credentials)

---

## Authentication

### POST /api/auth/login

Authenticate user and receive JWT token.

**Request:**
```json
{
  "email": "agent1@echoguard.com",
  "password": "agent123"
}
```

**Response (200 OK):**
```json
{
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440004",
    "name": "James Wilson",
    "email": "agent1@echoguard.com",
    "role": "agent",
    "supervisorId": "550e8400-e29b-41d4-a716-446655440002"
  }
}
```

**Error (401 Unauthorized):**
```json
{
  "error": "Invalid email or password"
}
```

**Note**: JWT token is returned as HTTP-only secure cookie `auth-token`.

---

### POST /api/auth/logout

Logout user and clear authentication.

**Response (200 OK):**
```json
{
  "message": "Logged out successfully"
}
```

---

### GET /api/auth/me

Get current authenticated user.

**Response (200 OK):**
```json
{
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440004",
    "name": "James Wilson",
    "email": "agent1@echoguard.com",
    "role": "agent",
    "supervisorId": "550e8400-e29b-41d4-a716-446655440002"
  }
}
```

**Error (401 Unauthorized):**
```json
{
  "error": "Not authenticated"
}
```

---

## Agent APIs

### GET /api/agent/stats

Get agent's performance statistics.

**Response (200 OK):**
```json
{
  "totalCalls": 150,
  "averageQaScore": 78.5,
  "totalCallDuration": 45000,
  "escalationRate": 0.15,
  "thisWeekCalls": 35,
  "thisMonthCalls": 120
}
```

**Access**: Agents can only view their own stats.

---

### GET /api/agent/calls

List agent's calls with pagination.

**Query Parameters:**
- `page` (number, default: 1) - Page number
- `limit` (number, default: 20) - Results per page

**Response (200 OK):**
```json
{
  "calls": [
    {
      "id": "650e8400-e29b-41d4-a716-446655440001",
      "callTime": "2024-01-15T10:30:00Z",
      "duration": 285,
      "sentimentScore": 0.75,
      "escalationRisk": "low",
      "evaluation": {
        "qaScore": 82,
        "scriptAdherenceScore": 85,
        "resolutionCorrectnessScore": 80
      }
    }
  ],
  "total": 150,
  "page": 1
}
```

---

### GET /api/agent/calls/[id]

Get detailed call information with transcript and evaluation.

**Response (200 OK):**
```json
{
  "call": {
    "id": "650e8400-e29b-41d4-a716-446655440001",
    "callTime": "2024-01-15T10:30:00Z",
    "duration": 285,
    "transcript": "Thank you for calling...",
    "sentimentScore": 0.75,
    "escalationRisk": "low",
    "evaluation": {
      "qaScore": 82,
      "scriptAdherenceScore": 85,
      "resolutionCorrectnessScore": 80,
      "sopViolations": {},
      "autoGenerated": true,
      "createdAt": "2024-01-15T11:00:00Z"
    },
    "alerts": [],
    "coachingInsights": [
      {
        "id": "950e8400-e29b-41d4-a716-446655440001",
        "text": "Great performance! Consider mentoring newer team members.",
        "priority": "low",
        "acknowledged": true
      }
    ]
  }
}
```

---

### GET /api/agent/coaching

Get unacknowledged coaching insights for agent.

**Response (200 OK):**
```json
{
  "insights": [
    {
      "id": "950e8400-e29b-41d4-a716-446655440001",
      "callId": "650e8400-e29b-41d4-a716-446655440003",
      "text": "Your script adherence score was 28/100. Focus on following the greeting and closing protocols more consistently.",
      "priority": "high",
      "acknowledged": false,
      "createdAt": "2024-01-15T11:00:00Z"
    }
  ]
}
```

---

### POST /api/agent/coaching/[id]/acknowledge

Mark coaching insight as acknowledged.

**Response (200 OK):**
```json
{
  "message": "Coaching insight acknowledged"
}
```

---

## Supervisor APIs

### GET /api/supervisor/stats

Get supervisor's team statistics.

**Response (200 OK):**
```json
{
  "teamSize": 4,
  "averageTeamQaScore": 75.2,
  "totalTeamCalls": 450,
  "lowPerformanceAgents": 2,
  "alertsThisWeek": 5,
  "callsThisWeek": 120
}
```

---

### GET /api/supervisor/agents

Get list of agents under supervisor.

**Response (200 OK):**
```json
{
  "agents": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440004",
      "name": "James Wilson",
      "email": "agent1@echoguard.com",
      "totalCalls": 150,
      "averageQaScore": 78.5,
      "thisWeekCalls": 35,
      "lowQualityCalls": 8
    }
  ]
}
```

---

### GET /api/supervisor/calls

Get calls from supervisor's team with filtering.

**Query Parameters:**
- `page` (number, default: 1)
- `limit` (number, default: 20)
- `filter` (string: "all" | "low_quality" | "escalated", default: "all")

**Response (200 OK):**
```json
{
  "calls": [
    {
      "id": "650e8400-e29b-41d4-a716-446655440001",
      "agentId": "550e8400-e29b-41d4-a716-446655440004",
      "agentName": "James Wilson",
      "callTime": "2024-01-15T10:30:00Z",
      "duration": 285,
      "sentimentScore": 0.75,
      "escalationRisk": "low",
      "qaScore": 82,
      "hasAlerts": false
    }
  ],
  "total": 450,
  "page": 1
}
```

---

### GET /api/supervisor/evaluations

Get evaluations for team calls.

**Response (200 OK):**
```json
{
  "evaluations": [
    {
      "id": "750e8400-e29b-41d4-a716-446655440001",
      "callId": "650e8400-e29b-41d4-a716-446655440001",
      "agentId": "550e8400-e29b-41d4-a716-446655440004",
      "agentName": "James Wilson",
      "qaScore": 82,
      "scriptAdherenceScore": 85,
      "resolutionCorrectnessScore": 80,
      "sopViolations": {},
      "autoGenerated": true,
      "createdAt": "2024-01-15T11:00:00Z"
    }
  ]
}
```

---

## Admin APIs

### GET /api/admin/stats

Get system-wide statistics.

**Response (200 OK):**
```json
{
  "totalUsers": 11,
  "totalAgents": 8,
  "totalCalls": 1500,
  "averageQaScore": 76.8,
  "alertsUnresolved": 6,
  "callsThisMonth": 1200
}
```

---

### GET /api/admin/users

Get list of all users in system.

**Query Parameters:**
- `page` (number, default: 1)
- `limit` (number, default: 20)
- `role` (string: "admin" | "supervisor" | "agent", optional)

**Response (200 OK):**
```json
{
  "users": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440001",
      "name": "Sarah Chen",
      "email": "admin@echoguard.com",
      "role": "admin",
      "supervisorName": null,
      "city": "San Francisco",
      "createdAt": "2024-01-01T00:00:00Z"
    }
  ]
}
```

---

### GET /api/admin/calls

Get all system calls with filtering.

**Query Parameters:**
- `page` (number, default: 1)
- `limit` (number, default: 20)
- `severity` (string: "low" | "medium" | "high", optional)

**Response (200 OK):**
```json
{
  "calls": [
    {
      "id": "650e8400-e29b-41d4-a716-446655440001",
      "agentId": "550e8400-e29b-41d4-a716-446655440004",
      "agentName": "James Wilson",
      "supervisorName": "Marcus Johnson",
      "callTime": "2024-01-15T10:30:00Z",
      "duration": 285,
      "sentimentScore": 0.75,
      "escalationRisk": "low",
      "qaScore": 82,
      "hasAlerts": false
    }
  ],
  "total": 1500
}
```

---

### GET /api/admin/analytics

Get system-wide analytics and trends.

**Response (200 OK):**
```json
{
  "topAgents": [
    {
      "name": "James Wilson",
      "averageQaScore": 88.5,
      "totalCalls": 150
    }
  ],
  "lowPerformers": [
    {
      "name": "Agent Name",
      "averageQaScore": 45.2,
      "totalCalls": 120
    }
  ],
  "qualityTrend": [
    { "week": 1, "score": 74.2 },
    { "week": 2, "score": 75.8 },
    { "week": 3, "score": 76.8 }
  ]
}
```

---

### GET /api/admin/settings

Get system settings and configuration.

**Response (200 OK):**
```json
{
  "settings": {
    "sopCategories": [
      "greeting",
      "communication",
      "security",
      "closing",
      "resolution"
    ],
    "escalationLevels": ["low", "medium", "high"],
    "roles": ["admin", "supervisor", "agent"],
    "system": "EchoGuard 1.0"
  }
}
```

---

## Error Handling

### Standard Error Response

All errors return appropriate HTTP status codes with error details:

```json
{
  "error": "Error message describing what went wrong"
}
```

### Common Status Codes

| Code | Meaning |
|------|---------|
| 200 | Success |
| 400 | Bad Request (invalid input) |
| 401 | Unauthorized (not authenticated) |
| 403 | Forbidden (insufficient permissions) |
| 404 | Not Found (resource doesn't exist) |
| 500 | Internal Server Error |

### Authentication Errors

**401 Unauthorized:**
```json
{
  "error": "Not authenticated"
}
```

### Authorization Errors

**403 Forbidden:**
```json
{
  "error": "You do not have permission to access this resource"
}
```

---

## Demo Credentials

Use these credentials to test the APIs:

### Admin User
```
Email: admin@echoguard.com
Password: admin123
Role: admin
```

### Supervisor Users
```
Email: supervisor1@echoguard.com
Password: supervisor123
Role: supervisor

Email: supervisor2@echoguard.com
Password: supervisor123
Role: supervisor
```

### Agent Users
```
Email: agent1@echoguard.com
Password: agent123
Role: agent

Email: agent2@echoguard.com
Password: agent123
Role: agent

... (agent3 through agent8 with same pattern)
```

---

## Example cURL Commands

### Login as Agent
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "agent1@echoguard.com",
    "password": "agent123"
  }' \
  -c cookies.txt
```

### Get Agent Stats
```bash
curl -X GET http://localhost:3000/api/agent/stats \
  -b cookies.txt
```

### Get Supervisor Calls
```bash
curl -X GET http://localhost:3000/api/supervisor/calls?page=1&limit=20 \
  -b cookies.txt
```

### Get Admin Users
```bash
curl -X GET http://localhost:3000/api/admin/users \
  -b cookies.txt
```

---

## Rate Limiting

Currently not implemented in development. Production deployment should implement rate limiting to prevent abuse.

## Pagination

All list endpoints support pagination with:
- `page` - Page number (1-indexed)
- `limit` - Number of results per page

Default limit: 20
Maximum limit: 100

---

## Timestamps

All timestamps are in ISO 8601 format with timezone (e.g., `2024-01-15T10:30:00Z`).

---

## Support

For API issues or questions, refer to the IMPLEMENTATION_SUMMARY.md or contact the development team.
